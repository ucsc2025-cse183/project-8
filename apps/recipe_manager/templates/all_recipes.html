[[extend 'layout.html']]

<style>
.recipe-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  padding: 20px;
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
}

.recipe-item {
  background: white;
  border-radius: var(--radius-md);
  padding: 1.25rem;
  margin-bottom: 0;
  border: 1.5px solid var(--primary-color);
  transition: all 0.2s ease;
  display: flex;
  flex-direction: column;
  min-height: 200px;
}

.recipe-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: var(--accent-color);
}

.recipe-content {
  flex-grow: 1;
  margin-bottom: 1rem;
}

.recipe-actions {
  margin-top: auto;
  display: flex;
  gap: 0.5rem;
  justify-content: flex-end;
  padding-top: 1rem;
}

.page-container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

.recipe-image {
  max-width: 300px;
  border-radius: 8px;
  margin-top: 0.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

</style>

<div id="app" class="page-container">
  <h2>All Recipes</h2>
  <div class="recipe-grid">
    <div v-for="recipe in recipes" :key="recipe.id" class="recipe-item">
      <div class="recipe-content">
        <h4>{{ recipe.name }}</h4>
        <p>{{ recipe.description }}</p>
        <img v-if="recipe.image" :src="`/recipe_manager/download/${recipe.image}`" alt="Recipe Image" class="recipe-image">
      </div>
      <div class="recipe-actions">
        <button @click="editRecipe(recipe)" class="submit-content">Edit</button>
        <button @click="deleteRecipe(recipe.id)" class="submit-content m1-2">Delete</button>
      </div>
    </div>
    <div v-if="recipes.length === 0" class="recipe-item">No recipes yet. Create your first recipe!</div>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      recipes: [],
      editingRecipe: null,
      currentRecipe: {
        name: "",
        description: "",
        instructions: "",
        ingredients: []
      }
    };
  },
  methods: {
    async loadRecipes() {
      const r = await fetch(`/recipe_manager/api/recipes`);
      const data = await r.json();
      this.recipes = data.recipes;
      console.log("Recipe image path: ", data.recipes.image)
    },
    editRecipe(recipe) {
      this.editingRecipe = recipe;
      this.currentRecipe = {
        id: recipe.id,
        name: recipe.name,
        description: recipe.description,
        instructions: recipe.instructions,
        ingredients: recipe.ingredients.map(i => ({
          id: i.ingredient_id,
          quantity: i.quantity
        }))
      };
    },
    async deleteRecipe(id) {
      if (!confirm("Are you sure you want to delete this recipe?")) return;
      
      try {
        const r = await fetch(`/recipe_manager/api/recipes/${id}`, {
          method: 'DELETE'
        });
        
        if (r.ok) {
          await this.loadRecipes();
        } else {
          const errorData = await r.json();
          alert(`Error deleting recipe: ${errorData.message || r.statusText}`);
        }
      } catch (e) {
        console.error("Error deleting recipe:", e);
        alert("An unexpected error occurred while deleting the recipe.");
      }
    }
  },
  mounted() {
    this.loadRecipes();
  }
}).mount("#app");
</script> 